<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Contact Manager</title>
  <script src="/javascripts/jquery.js"></script>
  <script src="/javascripts/handlebars.js"></script>
<style>
  #new-contact-form {
    display: none
  }
  table,th,td {
    border: 1px solid black;
  }
</style>
</head>
<body>
  <header>
    <h1>Contact Manager</h1>
  </header>
   <div id="main-container">
    <button id="add-contact-button">Add Contact</button>
    <br><br>
    <button id="view-contacts-button">View Contacts</button>
    <br><br>
    <form>
      <input type="text" id="search" name="search" placeholder="Search">
    </form>
  </div>
  <br>
  <div id="new-contact-form">
    <form>
      <label for="full-name">Full Name:</label>
      <input type="text" id="full-name" name="full-name">
      <br><br>
      <label for="email-address">Email Address:</label>
      <input type="email" id="email-address" name="email-address">
      <br><br>
      <label for="telephone-number">Telephone Number:</label>
      <input type="tel" id="telephone-number" name="telephone-number">
      <br><br>
      <button type="submit">Submit</button>
      <button type="button" id="cancel-new-contact">Cancel</button>
    </form>
  </div>
  <div id="edit-contact-form">
    <form>
      <label for="full-name">Full Name:</label>
      <input type="text" id="full-name" name="full-name">
      <br><br>
      <label for="email-address">Email Address:</label>
      <input type="email" id="email-address" name="email-address">
      <br><br>
      <label for="telephone-number">Telephone Number:</label>
      <input type="tel" id="telephone-number" name="telephone-number">
      <br><br>
      <button type="submit" id="update-edit-contact">Update</button>
      <button type="button" id="cancel-edit-contact">Cancel</button>
    </form>
  </div>
  <div id="all-contacts-table">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <!-- table rows will be added here dynamically using JavaScript -->
      </tbody>
    </table>
    <br><br>
    <button type="button" id="home-button">Home</button>
  </div>
<script>

$(document).ready(function() {
  // hide the new contact form and contacts table initially
  $('#new-contact-form, #all-contacts-table, #edit-contact-form').hide();

  // add click event listener to the Add Contact button
  $('#add-contact-button').click(function() {
    // hide the main container
    $('#main-container').hide();
    // show the new contact form
    $('#new-contact-form').show();
  });

  // function to fetch contacts from server and update table
  function fetchContacts() {
    // make a GET request to the API endpoint
    $.get('http://localhost:3000/api/contacts', function(response) {
      // remove existing rows from table
      $('#all-contacts-table tbody tr').remove();

      // loop through the contacts in the response and add them to the table
      response.forEach(function(contact) {
        var row = $('<tr></tr>');
        $('<td></td>').text(contact.full_name).appendTo(row);
        $('<td></td>').text(contact.phone_number).appendTo(row);
        $('<td></td>').text(contact.email).appendTo(row);

        // add edit and delete buttons to the Edit column
        $('<td></td>').html('<button class="edit-contact" data-id="' + contact.id + '">Edit</button> <button class="delete-contact" data-id="' + contact.id + '">Delete</button>').appendTo(row);

        $('#all-contacts-table tbody').append(row);
      });

      // add click event listener to each delete button
      $('.delete-contact').click(function() {
        // get the id of the contact to be deleted
        var contactId = $(this).data('id');
        // make a DELETE request to the server to delete the contact
        $.ajax({
          method: 'DELETE',
          url: 'http://localhost:3000/api/contacts/' + contactId,
          context: this, // save reference to clicked element
          success: function(response) {
            alert('Successfully deleted contact!');
            // remove the row from the table
            $(this).closest('tr').remove();
          },
          error: function(xhr, status, error) {
            alert('Error deleting contact :(');
            console.log('Error:', error);
          }
        });
      });

      // add click event listener to each edit button
      $('.edit-contact').click(function() {
        // get the id of the contact to be edited
        var contactId = $(this).data('id');
        
        // hide the full table/list of contacts
        $('#all-contacts-table').hide();
        
        // make a GET request to the server to retrieve contact details
        $.get('http://localhost:3000/api/contacts/' + contactId, function(response) {
          // update the values in the edit-contact-form
          $('#edit-contact-form #full-name').val(response.full_name);
          $('#edit-contact-form #telephone-number').val(response.phone_number);
          $('#edit-contact-form #email-address').val(response.email);

          // add a new input field for the contact id
          $('<input>').attr({
            type: 'hidden',
            name: 'id',
            value: contactId
          }).appendTo('#edit-contact-form');
          
          // display the edit-contact-form
          $('#edit-contact-form').show();
        });
      });
    });
  }

  // call the fetchContacts function initially to display all contacts on the table
  fetchContacts();

  // add click event listener to the View Contacts button
  $('#view-contacts-button').click(function() {
    // hide the main container
    $('#main-container').hide();
    // show the contacts table
    $('#all-contacts-table').show();

    // fetch contacts and update table
    fetchContacts();
  });

  // add click event listener to Cancel button / add new contact
  $('#cancel-new-contact').click(function() {
    // hide the new contact form
    $('#new-contact-form').hide();
    // show the main container
    $('#main-container').show();
  });

  // add click event listener to Cancel button / edit existing contact
  $('#cancel-edit-contact').click(function() {
    // hide the new contact form
    $('#edit-contact-form').hide();
    // show the main container
    $('#all-contacts-table').show();
  });

  // add click event listener to Home button
  $('#home-button').click(function() {
    // hide the new contact form
    $('#all-contacts-table').hide();
    // show the main container
    $('#main-container').show();
  });

  // add submit event listener to the contact form
  $('#new-contact-form form').submit(function(event) {
    event.preventDefault(); // prevent default form submit behavior

    // get form data
    var formData = {
      full_name: $('#full-name').val(),
      email: $('#email-address').val(),
      phone_number: $('#telephone-number').val()
    };

    // make AJAX POST request to server
    $.ajax({
      method: 'POST',
      url: 'http://localhost:3000/api/contacts/',
      data: formData,
      success: function(response) {
        alert('Successfully added new contact!');
        // hide the new contact form
        $('#new-contact-form').hide();
        // show the main container
        $('#main-container').show();
        // reset the form
        $('#new-contact-form form')[0].reset();
      },
      error: function(xhr, status, error) {
        alert('Error adding new contact :(');
        console.log('Error:', error);
      }
    });
  });

  // add submit event listener to the edit contact form
  $('#edit-contact-form form').submit(function(event) {
    event.preventDefault(); // prevent default form submit behavior

    // get the contact id from the hidden input field
    var contactId = $('#edit-contact-form input[type=hidden]').val();

    console.log('contactId: ', contactId);

    // get form data
    var formData = {
      full_name: $('#edit-contact-form #full-name').val(),
      email: $('#edit-contact-form #email-address').val(),
      phone_number: $('#edit-contact-form #telephone-number').val()
    };

    // make AJAX PUT request to server to update the contact
    $.ajax({
      method: 'PUT',
      url: 'http://localhost:3000/api/contacts/' + contactId,
      data: formData,
      success: function(response) {
        alert('Successfully updated contact!');
        // remove the ID from the edit contact form
        $('#edit-contact-form input[name="id"]').remove();
        // hide the edit contact form
        $('#edit-contact-form').hide();
        // show the contacts table
        $('#all-contacts-table').show();
        // fetch contacts and update table
        fetchContacts();
      },
      error: function(xhr, status, error) {
        alert('Error updating contact :(');
        console.log('Error:', error);
      }
    });
  });
});
</script>
</body>
</html>



